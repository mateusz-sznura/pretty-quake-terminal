#!/bin/bash

#
# Consts
#
LAST_ACTIVE_WIN_ID_FILE=/tmp/.pretty-gnome-terminal-last-active-win-id

#
# Open gnome-terminal if one is not already open
#
terminals=$(ps aux | grep gnome-terminal-server | wc -l)
if [ $terminals = 1 ]; then
    gnome-terminal
    wmctrl -R metju
fi

#
# Find terminal window id, then convert it from hex to dec
# and save in var
#
terminal_pid=`pgrep gnome-terminal`
set `wmctrl -lp | grep $terminal_pid`
terminal_win_id=$(echo $(($1)))

#
# Toggle terminal state between active and minimized 
# 
active_win_id=`xdotool getactivewindow`
if [ $active_win_id -eq $terminal_win_id ]
then
    if [ -s $LAST_ACTIVE_WIN_ID_FILE ]
    then
      wmctrl -i -a $(cat $LAST_ACTIVE_WIN_ID_FILE)
    else
      xdotool windowminimize $terminal_win_id
    fi
else
    echo $active_win_id > $LAST_ACTIVE_WIN_ID_FILE
    wmctrl -R metju
fi

# 
# For quick reference
# 
# wmctrl -r metju -b add,maximized_vert,maximized_horz
# wmctrl -r metju -b remove,shaded
# wmctrl -r metju -b remove,below
# wmctrl -r metju -b add,shaded
# wmctrl -r metju -b add,below
